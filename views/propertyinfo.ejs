<!DOCTYPE html>
<html lang="tr"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Work+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<title><%= title || 'Emlak Detayları' %> - UrbanNest</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<link rel="stylesheet" href="/assets/site.css" />
<link rel="stylesheet" href="/assets/theme.css" />
</head>
<body class="page-public bg-[var(--background)] text-[var(--text-primary)]" style='font-family: "Work Sans", "Noto Sans", sans-serif;'>
<div class="relative flex min-h-screen flex-col overflow-x-hidden">
<header class="site-nav flex items-center justify-between whitespace-nowrap px-10 py-4">
  <div class="flex items-center gap-10">
    <div class="flex items-center gap-3 text-[var(--text-primary)]">
      <div style="width:72px;height:72px;">
        <img src="/brand/logo.png" onerror="this.onerror=null;this.src='/brand/logo.jpeg'" alt="Logo" style="width:72px;height:72px;object-fit:contain;background-color:transparent;" />
      </div>
      <h2 class="brand text-xl leading-tight">Hacı Polat</h2>
    </div>
    <nav class="hidden md:flex items-center gap-8">
      <a class="nav-link" href="/">Anasayfa</a>
      <a class="nav-link" href="/properties">İlanlar</a>
      <a class="nav-link" href="/contact">İletişim</a>
    </nav>
  </div>
  <div class="flex flex-1 justify-end items-center gap-2 md:gap-4">
    <a href="/admin/login" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-md h-10 px-4 bg-transparent text-[var(--text-primary)] text-base font-bold leading-normal tracking-[0.015em] hover:bg-[var(--primary-color-light)] transition-colors">
      <span class="truncate">Giriş Yap</span>
    </a>
    <button type="button" class="hamburger-btn menu-toggle" aria-label="Menüyü aç">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </div>
</header>
<main class="container mx-auto flex-1 px-6 py-12">
<div class="mx-auto max-w-6xl">
<div class="mb-8">
<% if (typeof contact !== 'undefined' && contact === 'success') { %>
  <div class="mb-4 rounded-md border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-800">
    Mesajınız gönderildi. En kısa sürede dönüş yapılacaktır.
  </div>
<% } %>
<% if (typeof contact_error !== 'undefined' && contact_error) { %>
  <div class="mb-4 rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800">
    <%= contact_error %>
  </div>
<% } %>
<nav aria-label="Breadcrumb" class="flex text-sm">
<ol class="inline-flex items-center space-x-1 md:space-x-3">
<li class="inline-flex items-center">
<a class="inline-flex items-center text-gray-500 hover:text-gray-900" href="/properties"> Emlaklar </a>
</li>
<li>
<div class="flex items-center">
<svg class="h-6 w-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<path clip-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" fill-rule="evenodd"></path>
</svg>
<span class="ml-1 font-medium text-gray-800 md:ml-2"><%= property && property.ilanBaslik %></span>
</div>
</li>
</ol>
</nav>
</div>
<div class="grid grid-cols-1 gap-12 lg:grid-cols-3">
<div class="lg:col-span-2">
<div class="overflow-hidden rounded-lg shadow-lg">
  <div class="relative group">
    <div id="sliderTrack" class="flex h-96 w-full transition-transform duration-500 ease-in-out">
      <% const _photos = (property && property.photos && property.photos.length) ? property.photos : ["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='600'%3E%3Crect fill='%23e5e7eb' width='100%25' height='100%25'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='28' fill='%239ca3af'%3EG%C3%B6rsel Yok%3C/text%3E%3C/svg%3E"]; %>
      <% _photos.forEach(function(url){ %>
        <div class="w-full flex-shrink-0 bg-cover bg-center" style='background-image: url("<%= url %>");'></div>
      <% }) %>
    </div>
    <div class="pointer-events-none absolute inset-0 bg-black/10"></div>
    <!-- Prev/Next arrows -->
    <button id="prevPhoto" type="button" aria-label="Önceki" class="hidden md:flex absolute left-2 top-1/2 -translate-y-1/2 h-10 w-10 rounded-full bg-black/40 text-white items-center justify-center hover:bg-black/60 focus:outline-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-6 w-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
      </svg>
    </button>
    <button id="nextPhoto" type="button" aria-label="Sonraki" class="hidden md:flex absolute right-2 top-1/2 -translate-y-1/2 h-10 w-10 rounded-full bg-black/40 text-white items-center justify-center hover:bg-black/60 focus:outline-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-6 w-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
      </svg>
    </button>
    <div id="sliderDots" class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2">
      <% _photos.forEach(function(url, i){ %>
        <button type="button" class="h-2.5 w-2.5 rounded-full bg-white/60 hover:bg-white" data-index="<%= i %>"></button>
      <% }) %>
    </div>
  </div>
</div>
  <div class="mt-8">
  <div class="flex items-center gap-3">
    <h1 class="text-3xl font-bold text-gray-900"><%= property && property.ilanBaslik %></h1>
    <% const st = (property && property.status) ? property.status : 'active'; %>
    <% if (st === 'active') { %>
      <span class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800">Aktif</span>
    <% } else if (st === 'sold') { %>
      <span class="inline-flex items-center rounded-full bg-gray-100 px-3 py-1 text-sm font-medium text-gray-800">Satıldı</span>
    <% } else { %>
      <span class="inline-flex items-center rounded-full bg-yellow-100 px-3 py-1 text-sm font-medium text-yellow-800">Pasif</span>
    <% } %>
  </div>
<p class="mt-2 text-lg text-gray-600">
  <%= property && property.ilanOda %> oda ·
  <%= property && property.ilanBanyo %> banyo ·
  <%= property && property.ilanBoyut %> m²
  <% if (property && property.propertyType) { %> · <%= property.propertyType %><% } %>
</p>
  </div>
  <div class="mt-8">
    <h2 class="text-2xl font-bold text-gray-900">Genel Bakış</h2>
    <p class="mt-4 text-gray-600"><%= (property && property.ilanAciklama) ? property.ilanAciklama : 'Bu ilan için açıklama bulunmuyor.' %></p>
  </div>
  
<div class="mt-8">
<h2 class="text-2xl font-bold text-gray-900">Fotoğraflar</h2>
<div id="thumbGrid" class="mt-4 grid grid-cols-2 gap-4 sm:grid-cols-3">
  <% if (property && property.thumbs && property.thumbs.length) { %>
    <% property.thumbs.forEach(function(url, idx){ %>
      <button type="button" class="h-40 sm:h-48 w-full rounded-lg bg-cover bg-center ring-0 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)]" style='background-image: url("<%= url %>");' data-index="<%= idx %>"></button>
    <% }); %>
  <% } else { %>
    <div class="h-48 w-full rounded-lg bg-gray-100 flex items-center justify-center text-gray-500">Fotoğraf bulunmuyor</div>
  <% } %>
  </div>
</div>
</div>
  <div class="lg:col-span-1">
  <div class="sticky top-28 rounded-lg bg-[var(--card-bg)] border border-[var(--border-color)] p-6 shadow-lg">
<h2 class="text-2xl font-bold text-gray-900">Emlakçı ile İletişime Geçin</h2>
<form class="mt-6 space-y-4" action="/contact" method="POST">
<input type="hidden" name="subject" value="İlan İletişim: <%= property && property.ilanBaslik %> (#<%= property && property.ilanId %>)">
<div>
<label class="sr-only" for="name">Adınız</label>
<input class="form-input bg-gray-100" id="name" name="name" placeholder="Adınız" type="text" required/>
</div>
<div>
<label class="sr-only" for="email">E-postanız</label>
<input class="form-input bg-gray-100" id="email" name="email" placeholder="E-postanız" type="email" required/>
</div>
<div>
<label class="sr-only" for="phone">Telefonunuz</label>
<input class="form-input bg-gray-100" id="phone" name="phone" placeholder="Telefonunuz" type="tel"/>
</div>
<div>
<label class="sr-only" for="message">Mesajınız</label>
<textarea class="form-input bg-gray-100" id="message" name="message" placeholder="Mesajınız" rows="4" required></textarea>
</div>
<button class="w-full rounded-md bg-[var(--primary-color)] px-4 py-3 text-sm font-bold text-white shadow-sm hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] focus:ring-offset-2" type="submit">
                    Mesaj Gönder
                  </button>
</form>
  </div>
  <!-- Map card aligned with the contact card width; square layout -->
  <div class="mt-6 rounded-lg bg-[var(--card-bg)] border border-[var(--border-color)] p-4 shadow-lg">
    <h2 class="text-lg font-bold text-gray-900">Konum</h2>
    <% 
      const hasCoords = property && property.latitude && property.longitude;
      const mapsQuery = hasCoords 
        ? encodeURIComponent(`${property.latitude},${property.longitude}`)
        : (property && property.address ? encodeURIComponent(property.address) : null);
    %>
    <% if (mapsQuery) { %>
      <div class="mt-3 relative w-full" style="padding-top: 100%;">
        <iframe
          class="absolute inset-0 w-full h-full rounded-md"
          src="https://maps.google.com/maps?q=<%= mapsQuery %>&z=15&hl=tr&output=embed"
          style="border:0;"
          allowfullscreen
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
      <div class="mt-3">
        <a class="inline-flex items-center gap-2 text-[var(--primary-color)] font-semibold hover:opacity-80" href="https://maps.google.com/?q=<%= mapsQuery %>" target="_blank" rel="noopener">
          Google Haritalar'da Aç
        </a>
      </div>
      <% if (!hasCoords && property && property.address) { %>
        <p class="mt-2 text-sm text-gray-500">Adres: <%= property.address %></p>
      <% } %>
    <% } else { %>
      <p class="mt-2 text-sm text-gray-500">Konum bilgisi bulunamadı.</p>
    <% } %>
  </div>
  </div>
</div>
</div>
</main>
</div>
<%- include('partials/mobile-menu') %>
<script>
  (function(){
    try {
      const photos = <%- JSON.stringify((property && property.photos) ? property.photos : []) %>;
      const track = document.getElementById('sliderTrack');
      const prevBtn = document.getElementById('prevPhoto');
      const nextBtn = document.getElementById('nextPhoto');
      const grid = document.getElementById('thumbGrid');
      const dotsWrap = document.getElementById('sliderDots');
      let idx = 0;

      function update() {
        if (!track || !photos.length) return;
        track.style.transform = `translateX(-${idx * 100}%)`;
        if (dotsWrap) {
          const dots = dotsWrap.querySelectorAll('button[data-index]');
          dots.forEach((d,i)=>{
            if (i === idx) { d.classList.add('bg-white'); d.classList.remove('bg-white/60'); }
            else { d.classList.remove('bg-white'); d.classList.add('bg-white/60'); }
          });
        }
      }

      if (photos.length > 1) {
        if (prevBtn) prevBtn.classList.remove('hidden');
        if (nextBtn) nextBtn.classList.remove('hidden');
      }

      if (prevBtn) prevBtn.addEventListener('click', function(){
        idx = (idx - 1 + photos.length) % photos.length;
        update();
      });
      if (nextBtn) nextBtn.addEventListener('click', function(){
        idx = (idx + 1) % photos.length;
        update();
      });

      // Keyboard navigation
      document.addEventListener('keydown', function(e){
        if (!photos.length) return;
        if (e.key === 'ArrowLeft') { idx = (idx - 1 + photos.length) % photos.length; update(); }
        if (e.key === 'ArrowRight') { idx = (idx + 1) % photos.length; update(); }
      });

      // Thumbnail click navigation
      if (grid) {
        grid.addEventListener('click', function(e){
          const t = e.target.closest('button[data-index]');
          if (!t) return;
          const i = parseInt(t.getAttribute('data-index'), 10);
          if (!Number.isNaN(i)) { idx = i; update(); }
        });
      }

      // Dots click navigation
      if (dotsWrap) {
        dotsWrap.addEventListener('click', function(e){
          const t = e.target.closest('button[data-index]');
          if (!t) return;
          const i = parseInt(t.getAttribute('data-index'), 10);
          if (!Number.isNaN(i)) { idx = i; update(); }
        });
      }

      // Touch swipe support
      let startX = null;
      if (track) {
        track.addEventListener('touchstart', (e)=>{ startX = e.touches[0].clientX; }, { passive: true });
        track.addEventListener('touchend', (e)=>{
          if (startX == null) return;
          const dx = e.changedTouches[0].clientX - startX;
          if (Math.abs(dx) > 40) {
            if (dx < 0) { idx = (idx + 1) % photos.length; }
            else { idx = (idx - 1 + photos.length) % photos.length; }
            update();
          }
          startX = null;
        }, { passive: true });
      }

      // Initialize
      update();
    } catch (_) {}
  })();
</script>
<script src="/assets/menu.js" defer></script>
</body></html>
